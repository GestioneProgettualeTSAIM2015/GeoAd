@model GeoAdServer.WebApi.Models.LocationApiModel

@if (ViewBag.IsAdmin)
{
    <h2>Nuovo Punto d'Interesse</h2>
}
else
{
    <h2>Nuova Attività Commerciale</h2>
}

@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal" style="width:50%; float:left;">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        @Html.Hidden("lat", Model.Lat)
        @Html.Hidden("lng", Model.Lng)

        <div class="form-group">
            <p class="control-label col-md-2">Nome</p>
            <div class="col-md-10">
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <p class="control-label col-md-2">Categoria Principale</p>
            <div class="col-md-10">
                @Html.EditorFor(model => model.PCat, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.PCat, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <p class="control-label col-md-2">Categoria Secondaria</p>
            <div class="col-md-10">
                @Html.EditorFor(model => model.SCat, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.SCat, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <p class="control-label col-md-2">Descrizione</p>
            <div class="col-md-10">
                @Html.EditorFor(model => model.Desc, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Desc, "", new { @class = "text-danger" })
            </div>
        </div>
        <hr />

    </div>
    <div id="map_container" style="height: 400px; width: 50%;">
        
    </div>
    <br />
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Create" class="btn btn-default" />
        </div>
    </div>
}

<div>

    <hr />
    @Html.ActionLink("Home", "Home")
</div>

@section Scripts {
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">

        var map;
        var marker;

        function initializeMap()
        {
            var latlng = new google.maps.LatLng(45.9522249, 12.6791594);
            var options = { zoom: 16, center: latlng,
		    mapTypeId: google.maps.MapTypeId.ROADMAP};
            map = new google.maps.Map(document.getElementById("map_container"), options);

            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(event.latLng);
            });
        }

        function placeMarker(location)
        {
            document.getElementById('lat').value = location.A;
            document.getElementById('lng').value = location.F;

            if (marker != undefined)
            {
                marker.setMap(null);
            }

            marker = new google.maps.Marker({
                position: location,
                map: map
            });
        }

        $(function () {
            initializeMap();
        });
</script>
}
